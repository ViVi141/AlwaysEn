# AlwaysEn

> 版本：v2.1（2025-08-22）

## 简介

该应用程序是一个用Python编写的图形用户界面（GUI）工具，旨在智能监控并强制保持英文输入法状态。它提供三种监控模式：窗口监控、程序监控和路径监控，能够精确控制不同场景下的输入法切换。程序使用 `tkinter` 构建现代化界面，通过 `pygetwindow` 和 `psutil` 获取系统信息，并利用底层 WinAPI（`WM_INPUTLANGCHANGEREQUEST`、`AttachThreadInput`、`ActivateKeyboardLayout`）对目标窗口线程强制激活英文输入法布局（优先美国英语），确保高效稳定的输入法管理。

## 功能

- **三模式监控系统**: 
  - **窗口监控模式**: 监控指定的单个窗口，适合精确控制特定窗口的输入法状态
  - **程序监控模式**: 监控整个程序的所有窗口，适合需要在整个应用程序中保持英文输入法的场景
  - **路径监控模式**: 监控指定路径下的程序，当该程序启动并成为焦点窗口时自动执行输入法切换（新增功能）
- **智能窗口识别**: 用户可以从可用窗口列表中选择需要监控的目标窗口（已过滤空标题并去重）
- **进程级监控**: 支持通过进程名称和PID选择要监控的程序
- **路径级监控**: 支持通过文件路径选择要监控的程序，自动检测程序启动
- **实时输入法状态监控**: 实时监控选定窗口/程序的输入法状态；若为非英文则自动切回英文（支持多种英文布局识别，例如美式/英式）
- **现代化UI界面**: 通过直观的按钮、标签和分组布局，用户可以容易地启动、停止监控和刷新列表

## 系统要求

- Python 3.x
- `tkinter` (Python内置)
- `pygetwindow`
- `psutil` (进程管理)
- `pywin32` (Windows API)

## 安装

1. 请确保您已安装 Python 3.x。
2. 使用 `pip` 安装依赖库：
   ```bash
   pip install pygetwindow pywin32 pillow mouseinfo psutil
   ```

## 使用说明

1. 运行程序：
   ```bash
   python main.py
   ```
   或直接运行打包的exe文件：`AlwaysEn.exe`

2. 选择监控模式：
   - **窗口监控**：从窗口列表中选择特定窗口进行监控
   - **程序监控**：从进程列表中选择程序，监控该程序的所有窗口
   - **路径监控**：指定程序文件路径，自动监控该程序启动后的所有窗口

3. 根据选择的模式完成目标选择或路径设置。

4. 点击"开始监控"按钮开始智能输入法监控。

5. 如需停止，可随时点击"取消监控"。

6. 若目标程序需要更高权限，请以管理员身份运行本程序。

## 更新日志

- v2.1（2025-08-22）
  - 新增程序监控模式：支持监控整个程序的所有窗口，而不仅仅是单个窗口
  - 新增路径监控模式：支持通过文件路径监控程序，程序启动后自动检测并监控
  - 三模式监控系统：窗口监控、程序监控、路径监控三种模式自由切换
  - 进程列表功能：集成psutil库，提供完整的系统进程列表
  - 智能路径检测：自动验证程序路径有效性，支持文件浏览选择
  - 自动进程识别：无需手动选择进程，程序启动后自动识别并监控相关窗口
  - 路径级监控逻辑：根据程序路径自动检测前台窗口归属，实现真正的"监控程序"功能
  - UI界面优化：重新设计界面布局，支持监控模式选择，更直观的操作体验
  - 智能监控逻辑：根据监控模式自动调整检测和切换逻辑

- v2.0（2025-08-19）
  - 仅保留底层 WinAPI 切换方式：`WM_INPUTLANGCHANGEREQUEST`、`AttachThreadInput`、`ActivateKeyboardLayout`，移除热键循环切换方案。
  - 适配多进程/多窗口应用：通过根窗口句柄（`GetAncestor(GA_ROOT)`）判断是否属于同一顶层窗口，并针对前台窗口线程读取/切换输入法。
  - UI 优化：窗口分组、滚动列表、置顶开关、按钮状态、实时状态栏（显示 HKL/PID/窗口）、调试日志开关与节流。
  - 清理依赖：移除 `pyautogui`，保留 `pygetwindow`、`pywin32`、`pillow`、`mouseinfo`。

## 贡献

欢迎任何人提出建议或进行贡献！请提交问题、功能请求或直接提交拉取请求（PR）。

## 许可证
本项目采用 MIT 许可证，详情请查看 LICENSE 文件。